<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="">
<meta name="author" content="">

<title>国内首家喷人平台 打造第一发泄地噪音发生地</title>

<!-- Bootstrap Core CSS -->
<link rel="stylesheet" href="/css/css.css?v=15" />
<link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">
<!-- Custom CSS -->
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/chat.css"/>
<!-- Owl Carousel Assets -->
<link href="/owl-carousel/owl.carousel.css" rel="stylesheet">
<link href="/owl-carousel/owl.theme.css" rel="stylesheet">

<!-- Custom Fonts -->
<link rel="stylesheet"
	href="/font-awesome-4.4.0/css/font-awesome.min.css" type="text/css">
<!-- Custom styles for our template -->
<!-- 	<link rel="stylesheet" href="/assets/css/bootstrap-theme.css" media="screen" > -->
	<link rel="stylesheet" href="/assets/css/main.css">
	<link rel="stylesheet" href="/assets/js/highlight/styles/monokai.css">
<!-- jQuery and Modernizr-->
<script src="/js/jquery.min.js"></script>

<!-- Core JavaScript Files -->
<script src="/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/danmu/css/style.css" />
    <link rel="stylesheet" type="text/css" href="/danmu/css/barrager.css">
    <link rel="stylesheet" type="text/css" href="/danmu/pick-a-color/css/pick-a-color-1.2.3.min.css">
    <link type="text/css" rel="stylesheet" href="/danmu/syntaxhighlighter/styles/shCoreDefault.css"/>
    <script type="text/javascript" src="/danmu/js/tinycolor-0.9.15.min.js"></script>  
    <script type="text/javascript" src="/danmu/js/jquery.barrager.js"></script>
    <script type="text/javascript" src="/danmu/syntaxhighlighter/scripts/shCore.js"></script>
    <script type="text/javascript" src="/danmu/syntaxhighlighter/scripts/shBrushJScript.js"></script>
    <script type="text/javascript" src="/danmu/syntaxhighlighter/scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="/danmu/pick-a-color/js/pick-a-color-1.2.3.min.js"></script>   
    <link rel="stylesheet"
	href="/video-js//video-js.css" type="text/css">
    <script src="/video-js/video.js"></script>
<script src="/video-js/videojs-contrib-hls.min.js"></script>

<style type="text/css">
.div{
}
.chat{

}
	body {
		  font-family: "Microsoft YaHei" ! important;
		  font-color:#222;
	}
		pre {
			line-height: 2em;
		  font-family: "Microsoft YaHei" ! important;
	}
	h4 {
		line-height: 2em;
	}

 .chatmessage{
	margin-left: 12px;
	margin-top: 10px;
	vertical-align: middle; /* 居中对齐， */
	font-size: 16px;
}

	.ctr {
		font-size: 1em;
		  line-height: 2em;
	}
/* 	#danmu{ */
/* 	position: absolute; */
/* 	width: 650px; */
/* 	height: 650px; */
/* 	} */
</style>
</head>

<body>
	<header>
	<input type="hidden"  id="chatUserIdHidden"  value="${chatUserId }">
	<input type="hidden"  id="roomIdHidden"  value="${roomId }">
	<input type="hidden"  id="loginButton"  value="${loginStatus }">
	<input type="hidden"  id="chatUser"  value="${chatUser.roomAdmin }">
		<!--Top-->
		<nav id="top">
			<div class="container">
				<div class="row">
					<div class="col-md-6 col-sm-6">
					
					</div>
					<div class="col-md-6 col-sm-6">
						<ul class="list-inline top-link link">
							<li><a href="index.html"><i class="fa fa-home"></i> 主页</a></li>
							<li><a href="contact.html"><i class="fa fa-comments"></i>
									联系我们</a></li>
							<li><a href="#"><i class="fa fa-question-circle"></i> 关于</a></li>
						</ul>
					</div>
				</div>
			</div>
		</nav>

		<!--Navigation-->
		<nav id="menu" class="navbar">
			<div class="container">
	
				<div class="collapse navbar-collapse navbar-ex1-collapse">
					<ul class="nav navbar-nav">
						<li><a href="/index/gotoIndex"><i class="fa fa-home"></i> 主页</a></li>
						<li class="dropdown"><a href="#" class="dropdown-toggle"
							data-toggle="dropdown"><i class="fa fa-user"></i> 账号</a>
							<div class="dropdown-menu">
								<div class="dropdown-inner">
									<ul class="list-unstyled">
										<li><a href="/dispatcherLogin">登录</a></li>
									</ul>
								</div>
							</div></li>
					
						<li class="dropdown"><a href="#" class="dropdown-toggle"
							data-toggle="dropdown"><i class="fa fa-list"></i> 友链</a>
							<div class="dropdown-menu" style="margin-left: -203.625px;">
								<div class="dropdown-inner">
									<ul class="list-unstyled">
										<li><a href="archive.html">好友1</a></li>
										<li><a href="archive.html">好友1</a></li>
										<li><a href="archive.html">好友1</a></li>
										<li><a href="archive.html">好友1</a></li>
										<li><a href="archive.html">好友1</a></li>
									</ul>
									<ul class="list-unstyled">
										<li><a href="archive.html">Text 306</a></li>
										<li><a href="archive.html">Text 307</a></li>
										<li><a href="archive.html">Text 308</a></li>
										<li><a href="archive.html">Text 309</a></li>
										<li><a href="archive.html">Text 310</a></li>
									</ul>
									<ul class="list-unstyled">
										<li><a href="archive.html">Text 311</a></li>
										<li><a href="archive.html">Text 312</a></li>
										<li><a href="archive.html#">Text 313</a></li>
										<li><a href="archive.html#">Text 314</a></li>
										<li><a href="archive.html">Text 315</a></li>
									</ul>
								</div>
							</div></li>
					<li>
		<a id="modal-482296" href="#dashang" role="button" class="btn" data-toggle="modal"><i class="fa fa-cubes"></i>
		打赏</a>				
					</li>		
							<li>
		<a id="modal-482292" href="#contact" role="button" class="btn" data-toggle="modal"><i class="fa fa-cubes"></i>
		 联系作者</a>				
					</li>
					</ul>
				</div>
			</div>
		</nav>
	</header>
	<!-- Header -->

			
	<div class="modal fade" id="dashang" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
							<h4 class="modal-title" id="myModalLabel">
								友情提示
							</h4>
						</div>
						<div class="modal-body">
						<img src="/images/b.png"  style="height: 300px;width: 300px" class="img-rounded">
                     	<img src="/images/c.png"  style="height: 300px;width: 300px" class="img-rounded">
						</div>
						<div class="modal-footer">
							 <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button> <button type="button" class="btn btn-primary">保存</button>
						</div>
					</div>
					
				</div>
				
			</div>
	<div class="modal fade" id="contact" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
							<h4 class="modal-title" id="myModalLabel">
								友情提示
							</h4>
						</div>
						<div class="modal-body">
						<p> qq:1251272104</p>
						<img src="/images/a.png"  style="height: 300px;width: 300px" class="img-rounded">
						</div>
						<div class="modal-footer">
							 <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button> <button type="button" class="btn btn-primary">保存</button>
						</div>
					</div>
					
				</div>
				
			</div>
			

	<!-- /////////////////////////////////////////Content -->
	<div id="page-content" class="single-page">
		<div style="margin-top: 10px;margin-left: 10px">
			<div class="row">
				<div id="" class="col-lg-8">		
<div id="danmu">
				
<video id="example-video"  class="video-js vjs-default-skin "  width="100%" height="100%"  controls>
  <source
     src="http://192.168.1.33/hls/ding.m3u8"
     type="application/x-mpegURL">
</video>
</div>	

					<div class="line"></div>			
					<p style="margin-top: 20px">${room.roomIntroduce }</p>							
				</div>			
				<div id="" class="col-lg-4">
					<!---- Start Widget ---->
					<div class="panel panel-default"
						style="width: 350px; height: 540px; ">

						<div class="content">
							<ul id="myTab" class="nav nav-tabs">
								<li class="active"><a href="#chat" data-toggle="tab">
										无码交流区 </a></li>
								<li><a href="#rank" data-toggle="tab">土豪装逼区 </a></li>
							
								<li><a href="#fuli" data-toggle="tab">福利共享区 </a></li>
							</ul>
							<div id="myTabContent" class="tab-content">
								<div class="tab-pane fade in active" id="chat">
								<div style="background-color:green;">
									<div class="panel panel-default" >
					<div class="panel-body" style="width: 350px; height: 350px" >
				<div id="chatList" style="background-color:#FFFFF0;overflow-y:scroll;overflow-x:hidden;width: 350px; 
				height: 330px;"> 
				</div>
										</div>
									</div>
									
									</div>
					<div class="panel panel-default texttive">
				<div class="chat_button" id="loginButtonFor">
<a id="" class="login_button" href="/singleLogin?roomId=${room.id }" >请登录</a>
</div>	
			<textarea  id="sendChatMessage"		
									style="width: 349px; height: 80px; resize: none; border: 0; overflow-y: hidden;">
					</textarea>
			
									</div>		
													
								</div>
	
								<div class="tab-pane fade" id="rank">
								
									<section id="ranking" style="margin-top: 20px">								
									  <span id="ranking_title"> <a id="" href="/draw.ftl?chatUserId=${chatUserId }" title="变身">我要抽奖</a></span>
								
									 <br>
  <section id="ranking_list">
<#list chatUserList as chatUser>
    <section class="box">
      <section class="col_1" title="1"> ${chatUser_index+1}</section>
      <section class="col_2"><img src="/images/pic.jpg"  /></section>
      <section class="col_3">${chatUser.username }</section>
      <section class="col_4">${chatUser.score }</section>
    </section>
  </#list>
  </section>
  <a id="play_game" href="#" title="变身">开始变豪</a> 
  </section>

								</div>
												
								
					<div class="tab-pane fade" id="fuli">
								<div class="tab-pane fade in active" id="chatForTuhao">


									<div class="panel panel-default">
										<div class="panel-body" style="background-color:#FFFFF0;overflow-y:scroll;overflow-x:hidden;width: 350px; 
				height: 330px;"  id="chatListForTuhao">
			
											</div>
									</div>

									<div class="panel panel-default">

										<textarea   id="chatListFuli"
											style="width: 349px; height: 70px; resize: none; border: 0; overflow-y: hidden;"></textarea>

									</div>
									<div>
									<div style="float: right;margin-right: 20px">
	<span>按回车发送</span>
									</div>
									<div style="float: right;margin-right: 30px">
									  <img id="addImage"
										style="height: 30px; width: 30px"
										src="/images/addImge.jpg" alt=""
										onclick="showSelectButton()" class="img-responsive">
									</div>
									<!-- 图片上传组件隐藏，点击调用-->
									<input type="file" id="img" onchange="preView()"
								style="display: none">
									
									</div>
								</div>

								</div>
							</div>
						</div>

					</div>
				
			</div>
		</div>
	</div>
</div>
	<footer>
		
		<div class="bottom-footer">
			<div class="container">
				<div class="row">
					<div class="col-md-6 col-sm-6 copyright">
						<span >Copyright &copy; 2017.Company name All rights
							reserved.dingjianlei</a>
						</span>
					</div>
				</div>
			</div>
		</div>
	</footer>
	<!-- Footer -->

	<!-- JS -->
	<script src="/owl-carousel/owl.carousel.js"></script>

</script>

	<script type="text/javascript">
	var chatUser = $("#chatUser").val();
	var loginButtonStatus=$("#loginButton").val();
	//没登录显示登录按钮，并且text不可编辑
	if(loginButtonStatus=='no'){
		$("#loginButtonFor").show();
		$("#send").hide();	
		$("#sendChatMessage").attr( "disabled", true).css("cursor", "default");	
		}else{
			$("#chatUserIdHidden").val(loginButtonStatus);
		}
	   var player = videojs('example-video', { fluid: true }, function () {
           this.play();  
        });
	
	   var websocket=null;
			// 判断当前浏览器是否支持WebSocket
			if ('WebSocket' in window) {
				//websocket链接字符串
				var strConn = "ws://localhost:2080/chatServer?";
				//从隐藏域中取值
				var chatUserId=$("#chatUserIdHidden").val();
				var roomId=$("#roomIdHidden").val();
				strConn=strConn+"ROOMID="+roomId;
				strConn=strConn+"&CHATUSERID="+chatUserId;
				websocket = new WebSocket(strConn);
			} else {
				alert('browser Not support websocket')
			}

			// 连接发生错误的回调方法
			websocket.onerror = function() {
			
			};

			// 连接成功建立的回调方法
			websocket.onopen = function() {
				
			}
			// 接收到消息的回调方法
			websocket.onmessage = function(event) {
				if (event.data == 'SUCCESS') {
					successToServer();
					return;
				}
				var jsonObj = JSON.parse(event.data);
				setMessageOnHtml(jsonObj);
			
	             	if (jsonObj.messageType == 'IMAGE'
					|| jsonObj.messageType == 'BINARY'
					|| jsonObj.messageType == 'TORRENT'
					|| jsonObj.messageType == 'VIDEO') {
				return;
			}

			var item = {
				img : '/danmu/img/heisenberg.png', //图片 
				info : jsonObj.message, //文字 
				href : 'http://www.yaseng.org', //链接 
				close : true, //显示关闭按钮 
				speed : 8, //延迟,单位秒,默认8 
				// 						   bottom:, //距离底部高度,单位px,默认随机 
				color : getReandomColor(), //颜色,默认白色 
				old_ie_color : '#000000', //ie低版兼容色,不能与网页背景相同,默认黑色 
			};

			$('#danmu').barrager(item);
		}
	
		function addChat() {
			var now = new Date();
			var div = document.getElementById('chatList');
			div.scrollTop = div.scrollHeight;
		}
		function addChatTuhao() {
			var now = new Date();
			var div = document.getElementById('chatListForTuhao');
			div.scrollTop = div.scrollHeight;
			$("#chatListForTuhao").focus();
		}
		$('#sendChatMessage').keydown(function(e) {
			if (e.keyCode == 13) {
				createAndSendChatMessage();
			}
		});
		$('#chatListFuli').keydown(function(e) {
			if (e.keyCode == 13) {
				createAndSendChatMessageForFuli();
			}
		});	
		// 连接关闭的回调方法
		websocket.onclose = function() {
			// setMessageInnerHTML("WebSocket closed");
			alert("弹幕断开");
		}
		//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。
		window.onbeforeunload = function() {
			//连接关闭的回调方法
			websocket.onclose = function() {
			}
		}
		function waitBinary(jsonObj) {
			var uuid = jsonObj.uuid;
			var binaryAddress = jsonObj.binaryAddress;
			$("#" + uuid).load(function() {
			});
			$("#" + uuid).error(
					function() {
						$("#" + uuid).attr("src", "/images/loading.gif");
						var ime = setTimeout(function() {
							$("#" + uuid)
									.attr(
											"src",
											jsonObj.binaryAddress + "?"
													+ Math.random());
						}, 3000);
					});
		}
    
		//随机获取颜色值
		function getReandomColor() {
			return '#' + (function(h) {
				return new Array(7 - h.length).join("0") + h
			})((Math.random() * 0x1000000 << 0).toString(16))
		}
		function successToServer() {
			var p = "<span style='color:#00ff00'>连接弹幕成功，请开始你的表演。。。。</span><br>";
			var p1 = "<span style='color:#00ff00;font-size:15px'>可以上传和下载种子，图片，小视频都行哦~</span><br><br>";
			$("#chatList").append(p);
			$("#chatListForTuhao").append(p1);
			return;
		}
		function setMessageOnHtml(jsonObj) {
			if (typeof (jsonObj.chatName) == "undefined") {
				jsonObj.chatName = "佚名";
			}
			//如果是聊天消息
			if (jsonObj.messageMode == 'CHAT_MESSAGE'
					|| jsonObj.messageMode == 'ADMIN_MESSAGE') {
				if (jsonObj.messageType == 'TEXT') {
					if(jsonObj.messageFrom == 'FULI_AREA'){
						var word = "<div  class='chat_div'><img  class='chat_img'  src='/images/pic.jpg' />"
							+ "<span class='chat_word'>"
							+ jsonObj.chatName
							+ "：" + jsonObj.message + "</span></div>";
					$("#chatListForTuhao").append(word);
					addChatTuhao();
					}else{
						var word = "<div  class='chat_div'><img  class='chat_img'  src='/images/pic.jpg' />"
							+ "<span class='chat_word'>"
							+ jsonObj.chatName
							+ "：" + jsonObj.message + "</span></div>";
					$("#chatList").append(word);
					addChat();
					}				
				} else if (jsonObj.messageType == 'IMAGE') {
					var image = "<div  class='chat_div'><img class='chat_img'  src='/images/pic.jpg' />"
							+ jsonObj.chatName
							+ "："
							+ "</div>	"
							+"<a target='_blank' href='"
							+jsonObj.binaryAddress
							+"'><img id='"
							+jsonObj.uuid
							+"'class='chat_image' src='"
					        +jsonObj.binaryAddress
					        +"'></img></a>";
					$("#chatListForTuhao").append(image);
					waitBinary(jsonObj);
					addChatTuhao();
					return;
				} else if (jsonObj.messageType == 'VIDEO') {
					var image = "<div  class='chat_div'><img class='chat_img'  src='/images/pic.jpg' />"
						+ jsonObj.chatName
						+ "："
						+ "</div>	"
						+ "<video width='240' height='240'  controls='controls'>"
						+" <source src="
						+ jsonObj.binaryAddress
						+" type='video/mp4'></video>"
				$("#chatListForTuhao").append(image);
				waitBinary(jsonObj);
				addChatTuhao();
				return;
				} else if (jsonObj.messageType == 'TORRENT') {
					var image = "<div  class='chat_div'><img class='chat_img'  src='/images/pic.jpg' />"
						+ jsonObj.chatName
						+ "："
						+ "</div>	"
						"<a target='view_window' href='"
						+ jsonObj.binaryAddress+"'>"
						+"<img id='"
						+jsonObj.uuid
						+"'class='chat_image' src='/images/torrent.jpg'></img></a>";
				$("#chatListForTuhao").append(image);
				waitBinary(jsonObj);
				addChatTuhao();
				return;
				} else if (jsonObj.messageType == 'BINARY') {
					var image = "<div  class='chat_div'><img class='chat_img'  src='/images/pic.jpg' />"
						+ jsonObj.chatName
						+ "："
						+ "</div>	"
						+"<a target='view_window' href='"
						+ jsonObj.binaryAddress+"'>"
						+"<img id='"
						+jsonObj.uuid
						+"'class='chat_image' src='/images/binary.png'></img></a>";
				$("#chatListForTuhao").append(image);
				waitBinary(jsonObj);
				addChatTuhao();
				return;
				}
			}
			//系统广播
			else {

			}
		}

		//创建福利聊天消息	
		function createAndSendChatMessageForFuli() {
			var jsonObj = {};
			jsonObj.uuid = UUID();
			if (chatUser == 'YES') {
				jsonObj.messageMode = "ADMIN_MESSAGE";
			} else {
				jsonObj.messageMode = "CHAT_MESSAGE";
			}
			jsonObj.messageFrom="FULI_AREA";
			jsonObj.messageType = "TEXT";
			jsonObj.message = document.getElementById('chatListFuli').value;
			var str = jQuery.trim(jsonObj.message);//去除空格
			if (str == "") {
				alert("发送的字符串不能为空");
				return;
			}
			websocket.send(JSON.stringify(jsonObj));
			$("#chatListFuli").val("");
			$("#chatListFuli").focus();
		}
		//创建聊天消息	
		function createAndSendChatMessage() {
			var jsonObj = {};
			jsonObj.uuid = UUID();
			jsonObj.messageFrom="ORIGNL_AREA";
			if (chatUser == 'YES') {
				jsonObj.messageMode = "ADMIN_MESSAGE";
			} else {
				jsonObj.messageMode = "CHAT_MESSAGE";
			}

			jsonObj.messageType = "TEXT";
			jsonObj.message = document.getElementById('sendChatMessage').value;
			var str = jQuery.trim(jsonObj.message);//去除空格
			if (str == "") {
				alert("发送的字符串不能为空");
				return;
			}
			websocket.send(JSON.stringify(jsonObj));
			$("#sendChatMessage").val("");
			$("#sendChatMessage").focus();
		}
		//发送图片或者文件
		function preView() {
			var img = document.getElementById('img');
			var suffix = img.value;
			var strs = new Array(); //定义一数组用来接收后缀
			strs = suffix.split(".");
			var fileSuffix = strs[1];
			var imgFile = new FileReader();
			imgFile.readAsDataURL(img.files[0]);
			imgFile.onload = function() {
				sendBinary(this.result, fileSuffix);
			}
		}
		/**
		发送二进制文件  图片 小视频 种子文件 动图
		 **/

		function sendBinary(binary, fileSuffix) {
			var jsonObj = {};
			jsonObj.uuid = UUID();
			jsonObj.messageFrom="FULI_AREA";
			if (chatUser == 'YES') {
				jsonObj.messageMode = "ADMIN_MESSAGE";
			} else {
				jsonObj.messageMode = "CHAT_MESSAGE";
			}
			if (fileSuffix == 'GIF' || fileSuffix == 'gif'
					|| fileSuffix == 'JPEG' || fileSuffix == 'jpeg'
					|| fileSuffix == 'PNG' || fileSuffix == 'png'
					|| fileSuffix == 'JPG' || fileSuffix == 'jpg') {
				jsonObj.messageType = "IMAGE";
			}

			else if (fileSuffix == 'torrent') {
				jsonObj.messageType = "TORRENT";
			} else if (fileSuffix == 'mp4' || fileSuffix == 'avi'
					|| fileSuffix == 'mov' || fileSuffix == 'flv'
					|| fileSuffix == 'rmvb' || fileSuffix == 'wmv'
					|| fileSuffix == 'MP4' || fileSuffix == 'AVI'
					|| fileSuffix == 'MOV' || fileSuffix == 'FLV'
					|| fileSuffix == 'RMVB' || fileSuffix == 'WMV') {
				jsonObj.messageType = "VIDEO";
			} else {
				jsonObj.messageType = "BINARY";
			}
			jsonObj.suffix = fileSuffix;
			jsonObj.imageBase64 = binary;
			var messageJson = JSON.stringify(jsonObj);
			websocket.send(messageJson);
		}

		function UUID() {
			var s = [];
			var hexDigits = "0123456789abcdef";
			for (var i = 0; i < 36; i++) {
				s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
			}
			s[14] = "4"; // bits 12-15 of the time_hi_and_version field to 0010
			s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01
			s[8] = s[13] = s[18] = s[23] = "-";
			var uuid = s.join("");
			return uuid;
		}
		function showSelectButton() {
			$("#img").click();
		}
	</script>
      
</script>
</body>
</html>
